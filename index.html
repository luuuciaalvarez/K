<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asistente de Voz</title>
  <style>
    /* Estilos b치sicos para mejorar la visualizaci칩n */
    body { font-family: sans-serif; margin: 2em; }
    #output { margin-top: 1em; padding: 1em; border: 1px solid #ccc; border-radius: 5px; }
    .user-input { font-weight: bold; }
    .assistant-response { margin-bottom: 1em; }
  </style>
</head>
<body>
  <!-- Campo de entrada de texto y bot칩n de env칤o -->
  <form id="chatForm">
    <input type="text" id="inputMessage" placeholder="Escribe tu mensaje..." required />
    <button type="submit">Enviar</button>
    <button type="button" id="voiceBtn">游꿗 Hablar</button>
  </form>

  <!-- Contenedor para mostrar la conversaci칩n -->
  <div id="output"></div>

  <script>
    // Compatibilidad con SpeechRecognition (reconocimiento de voz)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.lang = "es-ES";            // idioma espa침ol (ajustar seg칰n necesidad)
      recognition.continuous = false;        // solo una frase a la vez
      recognition.interimResults = false;    // no mostrar resultados intermedios
      // Evento que se dispara cuando hay resultados de voz
      recognition.onresult = (event) => {
        const transcrito = event.results[0][0].transcript;
        document.getElementById('inputMessage').value = transcrito;
        sendMessage();  // env칤a autom치ticamente el mensaje transcrito
      };
    } else {
      // Si el navegador no soporta SpeechRecognition
      document.getElementById('voiceBtn').disabled = true;
      document.getElementById('voiceBtn').title = "Reconocimiento de voz no soportado en este navegador.";
    }

    // Manejar clic en el bot칩n de voz
    document.getElementById('voiceBtn').addEventListener('click', () => {
      if (recognition) {
        recognition.start();
      }
    });

    // Manejar env칤o del formulario de chat
    document.getElementById('chatForm').addEventListener('submit', function(event) {
      event.preventDefault(); // evita recarga de la p치gina
      sendMessage();
    });

    // Funci칩n para enviar el mensaje a la API y obtener respuesta
    function sendMessage() {
      const mensaje = document.getElementById('inputMessage').value.trim();
      if (!mensaje) return;  // no enviar si est치 vac칤o

      // Opcional: mostrar el mensaje del usuario en la conversaci칩n
      agregarAlOutput(mensaje, 'user-input');

      // Llamada a la API (POST del mensaje)
      fetch('URL_DE_LA_API', {  // Reemplazar con la URL real de la API
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: mensaje })
      })
      .then(response => response.json())
      .then(data => {
        // Asegurar que data.response sea texto
        let responseText = data.response;
        if (typeof responseText !== 'string') {
          // Si es un objeto, intentar obtener texto o convertir a cadena
          try {
            // Si tiene una propiedad 'message' o 'content', usarla
            if (responseText.message) {
              responseText = responseText.message;
            } else if (responseText.content) {
              responseText = responseText.content;
            } else {
              // Si no, convertir todo el objeto a JSON string
              responseText = JSON.stringify(responseText);
            }
          } catch(e) {
            responseText = String(responseText);
          }
        }
        // Mostrar y leer la respuesta
        displayResponse(responseText);
      })
      .catch(error => {
        console.error("Error en la solicitud a la API:", error);
      });
    }

    // Funci칩n para mostrar la respuesta en la p치gina y convertirla a voz
    function displayResponse(text) {
      if (!text) return;
      // Mostrar la respuesta en el contenedor de salida
      agregarAlOutput(text, 'assistant-response');
      // Reproducir la respuesta en voz alta (si la s칤ntesis est치 disponible)
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "es-ES";  // idioma espa침ol para la voz (ajustar si es necesario)
        window.speechSynthesis.speak(utterance);
      }
    }

    // Funci칩n auxiliar para agregar texto al div de salida con formato
    function agregarAlOutput(texto, clase) {
      const outputDiv = document.getElementById('output');
      const paragraph = document.createElement('p');
      paragraph.textContent = texto;
      paragraph.className = clase;
      outputDiv.appendChild(paragraph);
    }
  </script>
</body>
</html>
